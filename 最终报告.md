# 基于用户态中断的进程间通信以及异步IO

- [toc]

## 摘要

近年来, 微内核的影响力越来越大, 但是微内核的服务调用收到IPC性能的约束, 性能优越的解决方案(如XPC)对硬件和内核的修改成本过大。对于宏内核而言, 频繁的通过系统调用操作外设中上下文切换的开销也变得不容忽视, 而基于用户态的驱动实现又依赖轮询, 消耗cpu资源。**用户态中断( User Interrupt )**是一种新的硬件特性, 使得用户态的程序能够接受到中断, 并进入指定的中断处理函数中, 中断过程由硬件发送, 无需经过内核。本项目探索运用新一代 Intel 硬件特性用户态中断，搭建运行环境, 进行IPC的性能测试并与传统IPC方式进行比较。  我们的结果表明, 利用用户态中断来进行进程间通信, 因其不需要进过内核, 从而性能相比传统进程间通信有数量级上的优势。此外我们还通过将用户态中断和linux io_uring子系统结合, 以用户态中断作为io完成的通知机制, 实现了双向的异步调用过程, 在保证异步基本的特性的情况下获取了更低的io延迟。



## 需求背景

近年来, 微内核的影响力越来越大, 微内核的重要特征是将内核与系统服务层分离出来，如文件系统、网络、GUI等都变成用户态进程，内核只保留最重要的进程管理、内存管理、进程间通信等功能。微内核架构



## 用户态中断



### 用户态中断的提出



### 用户态中断的特点



### x86用户态中断的实现



### 基于qemu的实现





## 基于用户态中断的进程间通信

### 实验设定





### 性能结果



## 基于用户态中断的异步IO

### 异步编程简介

#### 异步的需求和本质



#### 简单的同步/异步实现分类



### io_uring异步框架简介

![image-20220815084334928](./最终报告.assets/image-20220815084334928.png)



### 用户态中断+io_uring实现





### 实验设定



### 实验结果



## 讨论



## 结论



## 感想



## 致谢

感谢陈渝老师和向勇老师的指导！

感谢校外导师提供的帮助和硬件支持!

感谢贾越凯、贺鲲鹏、尤予阳、张译仁以及其他学长的帮助！